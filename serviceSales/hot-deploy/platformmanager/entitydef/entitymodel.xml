<?xml version="1.0" encoding="UTF-8"?>
<entitymodel xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/entitymodel.xsd">
    <!-- ========================================================= -->
    <!-- ======================== Defaults ======================= -->
    <!-- ========================================================= -->
    <title>Entity of PlatformManager Component</title>
    <description>PlatformModel</description>
    <copyright>CloudLake</copyright>
    <version>1.0</version>

    <!-- Tele & Party View -->
    <view-entity entity-name="TelecomNumberAndPartyView" package-name="com.banfftech.personerp">
        <member-entity entity-alias="PCM" entity-name="PartyContactMech"/>
        <member-entity entity-alias="PCMP" entity-name="PartyContactMechPurpose"/>
        <member-entity entity-alias="CM" entity-name="ContactMech"/>
        <member-entity entity-alias="TN" entity-name="TelecomNumber"/>
        <alias entity-alias="PCM" name="partyId" field="partyId"/>
        <alias entity-alias="PCM" name="fromDate" field="fromDate"/>
        <alias entity-alias="PCM" name="thruDateParty" field="thruDate"/>
        <alias entity-alias="PCMP" name="thruDatePartyPu" field="thruDate"/>
        <alias entity-alias="PCMP" name="contactMechPurposeTypeId" field="contactMechPurposeTypeId"/>
        <alias entity-alias="CM" name="contactMechTypeId" field="contactMechTypeId"/>
        <alias entity-alias="TN" name="contactNumber" field="contactNumber"/>
        <view-link entity-alias="PCM" rel-entity-alias="PCMP">
            <key-map field-name="partyId" rel-field-name="partyId"/>
            <key-map field-name="contactMechId" rel-field-name="contactMechId"/>
            <entity-condition>
                <condition-list>
                    <condition-expr entity-alias="PCM" field-name="thruDate" operator="equals" value=""/>
                    <condition-expr entity-alias="PCMP" field-name="thruDate" operator="equals" value=""/>
                </condition-list>
            </entity-condition>
        </view-link>
        <view-link entity-alias="PCM" rel-entity-alias="CM">
            <key-map field-name="contactMechId" rel-field-name="contactMechId"/>
        </view-link>
        <view-link entity-alias="PCM" rel-entity-alias="TN">
            <key-map field-name="contactMechId" rel-field-name="contactMechId"/>
        </view-link>
        <entity-condition>
            <order-by field-name="-fromDate"/>
        </entity-condition>
    </view-entity>

    <!--Sms-->
    <entity entity-name="SmsValidateCode" package-name="org.ofbiz.cloudLake.sms" title="短信验证码">
        <description>短信验证码</description>
        <field name="teleNumber" type="id"></field>
        <field name="smsType" type="short-varchar"></field>
        <field name="captcha" type="id"></field>
        <field name="isValid" type="id"></field>
        <field name="fromDate" type="date-time"></field>
        <field name="thruDate" type="date-time"></field>
        <prim-key field="teleNumber"/>
        <prim-key field="captcha"/>
        <prim-key field="fromDate"/>
    </entity>
    <!-- 记录转发 -->
    <entity entity-name="DistributingLeaflets" package-name="org.ofbiz.cloudLake.sms" title="DistributingLeaflets">
        <description>记录转发信息</description>
        <field name="DLId" type="id"></field>
        <field name="productId" type="value"></field>
        <field name="sellerPartyId" type="value"></field>
        <field name="buyerPartyId" type="value"></field>
        <field name="workerPartyId" type="value"></field>
        <field name="workerName" type="value"></field>
        <prim-key field="DLId"/>
    </entity>

    <!--Message-->
    <entity entity-name="MessageLog" package-name="org.ofbiz.cloudLake.message" title="Message">
        <description>Message</description>
        <field name="messageId" type="id"></field>
        <field name="messageLogTypeId" type="id"></field>
        <!--<field name="objectTypeId" type="id"></field>-->
        <field name="partyIdFrom" type="value"></field>
        <!-- 谈吐围绕者,可能是订单，也可能是别的 -->
        <field name="objectId" type="value"></field>
        <field name="partyIdTo" type="value"></field>
        <field name="message" type="value"></field>
        <field name="fromDate" type="date-time"></field>
        <field name="badge" type="value"></field>
        <!--<prim-key field="objectTypeId"/>-->
        <prim-key field="messageId"/>
        <prim-key field="fromDate"/>
        <prim-key field="messageLogTypeId"/>
        <relation type="one" rel-entity-name="MessageLogType">
            <key-map field-name="messageLogTypeId"/>
        </relation>
    </entity>


    <entity entity-name="MessageLogType" package-name="org.ofbiz.cloudLake.message" title="MessageLogType">
        <description>MessageLogTypeId</description>
        <field name="messageLogTypeId" type="id"></field>
        <field name="description" type="value"></field>
        <prim-key field="messageLogTypeId"/>
    </entity>


</entitymodel>